# Stockity

**서버-클라이언트 기반 주식 시뮬레이션 시스템**

Spring Boot + JPA + WebSocket 기반으로,
2시간마다 장이 열리고 사용자는 주식을 사고팔며 경쟁하는 게임입니다.
주가는 5분마다 갱신되고 사건(Event)은 15~30분마다 발생하여 주가에 반영됩니다.
현재는 2시간 마다 장이 마감되며 사용자의 수익률에 따라 랭킹이 갱신됩니다. 
추후 확장이 되면 실시간 주식 장처럼 하루 기준으로 운영될 예정입니다.
---

## 1. 프로젝트 개요

| 항목     | 내용                                                                       |
| ------ |--------------------------------------------------------------------------|
| 프로젝트명  | Stock Simulator                                                          |
| 개발 언어  | Kotlin (Java 21)                                                         |
| 프레임워크  | Spring Boot                                                              |
| 데이터베이스 | MySQL                                                                    |
| 기술 스택  | Spring Web, Spring Scheduler, JPA, OAuth2.0, WebSocket, Lombok, RabbitMQ |
| 시스템 구성 | REST API + WebSocket + Message Queue                                     |

---

## 2. 요구사항 명세서

### 2.1 사용자 요구사항 (User Requirements)

| ID    | 설명                     |
| ----- | ---------------------- |
| UR-01 | 로그인 및 회원가입 가능          |
| UR-02 | 보유 현금을 이용해 주식 매수/매도 가능 |
| UR-03 | 실시간 주가 확인 가능           |
| UR-04 | 사건 발생 시 주가 즉시 반영       |
| UR-05 | 자산, 거래 내역, 수익률 확인 가능   |
| UR-06 | 전체 유저 수익률 기준 랭킹 조회 가능  |

### 2.2 개발자 요구사항 (System / Developer Requirements)

| ID    | 설명                                     |
| ----- |----------------------------------------|
| SR-01 | Spring Boot 기반 REST API + WebSocket 지원 |
| SR-02 | 5분마다 주가 자동 갱신                          |
| SR-03 | 15~30분마다 사건 랜덤 생성 및 DB 저장              |
| SR-04 | EventService가 주가 갱신 시 사건 반영            |
| SR-05 | 거래 기록(사용자, 주식, 수량, 가격, 거래 유형) 저장       |
| SR-06 | 라운드 종료 시 사용자 수익률 계산 및 랭킹 갱신            |
| SR-07 | WebSocket으로 실시간 주가/사건 전송               |
| SR-08 | JPA 기반 DB 설계, 사건-주식 연관관계 설정            |
| SR-09 | 스케줄러 주기 `application.yml`에서 설정 가능      |
| SR-10 | 장 마감 2시간마다 강제 매도 처리                    |
| SR-11 | 장 마감 후 수익률 계산 후 랭킹 반영                  |
| SR-12 | 초기 개발 단계는 주가 랜덤 변동                     |

> 주식 거래 예외: 잔액 부족, 주문 수량 초과 시 처리 로직 필요

---

## 3. 동작 흐름

1. **주가 갱신 (5분 주기)**

    * `ChangeTask` 실행
    * DB에서 사건 조회 후 영향 반영
    * 랜덤 변동 적용

2. **사건 생성 (15~30분 주기)**

    * `EventTask` 실행
    * 사건 유형(긍정/부정), 영향도, 설명 랜덤 생성
    * DB에 저장 후 다음 주가 갱신에 반영

3. **사용자 거래**

    * REST API로 매수/매도 요청
    * 거래 내역 DB 저장, 잔액/보유 주식 갱신
    * WebSocket으로 실시간 주가/사건 전송

4. **장 마감 (2시간 주기)**

    * 모든 사용자의 보유 주식 강제 매도
    * 거래 마감, 최종 수익률 계산 후 랭킹 반영
    * 다음 장을 위해 초기 자본금으로 리셋

5. **격동 / 테마 적용**
    * `SectorTheme` 엔티티로 장 특성 저장
    * 예: 기술주 강세장, 경기침체장 등
    * 특정 섹터/테마 주식 가격 가중치 적용 가능

6. **추가 변동성 요소**
   * 회사마다 고유 변동성(positive_rate, negative_rate) 적용
   * 장 마감 시 각 회사의 변동성에 따라 주가 조정
   * 예: 변동성 높은 회사는 장 마감 후 결과에 따라 주가가 더 크게 변동
   * 이를 통해 투자 전략 다양화 유도

---

## 4. 스케줄러 주기

| 항목    | 주기     | 설명                      |
| ----- | ------ |-------------------------|
| 주가 갱신 | 5분     | 전체 주식 랜덤 변동 + 사건 반영     |
| 사건 생성 | 15~30분 | 새로운 사건(Event) DB 저장     |
| 랭킹 갱신 | 2시간    | 사용자 수익률 재계산             |
| 장 마감  | 2시간    | 보유 주식 강제 매도 및 사용자 자금 리셋 |

---
