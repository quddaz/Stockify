# Stockity

**서버-클라이언트 기반 주식 시뮬레이션 시스템**

Spring Boot + JPA + WebSocket 기반으로 동작하며,
2시간마다 장이 열리고 사용자는 주식을 사고팔며 경쟁하는 게임 형태의 시스템입니다.
주가는 **5분마다 갱신**, 사건(Event)은 **15~30분 간격으로 발생**하여 주가에 반영됩니다.
현재는 **2시간 기준 장 운영 → 마감 → 수익률 계산 후 랭킹 반영**,
추후에는 **실제 주식 시장처럼 하루 단위 운영**으로 확장될 예정입니다.

---

## 1. 프로젝트 개요

| 항목     | 내용                                                        |
| ------ | --------------------------------------------------------- |
| 프로젝트명  | Stock Simulator                                           |
| 개발 언어  | Kotlin (Java 21)                                          |
| 프레임워크  | Spring Boot                                               |
| 데이터베이스 | MySQL                                                     |
| 기술 스택  | Spring Web, JPA, Scheduler, OAuth2.0, WebSocket, RabbitMQ |
| 시스템 구성 | REST API + WebSocket + Message Queue                      |

---

## 2. 요구사항 명세서

### 2.1 사용자 요구사항

| ID    | 설명                    |
| ----- | --------------------- |
| UR-01 | 회원가입 및 로그인 지원         |
| UR-02 | 보유 자금으로 주식 매수/매도 기능   |
| UR-03 | 실시간 주가 조회 기능          |
| UR-04 | 사건 발생 시 주가 즉시 반영      |
| UR-05 | 자산·잔고·거래내역·수익률 조회 가능  |
| UR-06 | 전체 유저 기준 수익률 랭킹 조회 가능 |

### 2.2 시스템 / 개발 요구사항

| ID    | 설명                                 |
| ----- | ---------------------------------- |
| SR-01 | REST API + WebSocket 기반 시스템 구성     |
| SR-02 | 5분마다 전체 주식 자동 갱신                   |
| SR-03 | 15~30분 간격으로 사건 랜덤 생성 및 저장          |
| SR-04 | 주가 갱신 시 사건 내용 반영                   |
| SR-05 | 모든 거래는 DB에 거래 기록으로 저장              |
| SR-06 | 장 마감 시 사용자 수익률 계산 후 랭킹 업데이트        |
| SR-07 | 주가/사건 정보를 WebSocket으로 실시간 전송       |
| SR-08 | JPA 기반 구조 및 사건-주식 관계 매핑            |
| SR-09 | 스케줄러 주기 설정을 `application.yml`에서 관리 |
| SR-10 | 장 마감 시 모든 보유 주식 강제 매도 처리           |
| SR-11 | 매도 이후 수익률 계산 후 랭킹 반영               |
| SR-12 | 초기 단계에서는 주가 랜덤 변동                  |
| SR-13 | 스케줄러 간 우선 처리 순서 보장                 |
| SR-14 | 작업 순서를 유지하기 위해 메시지 큐(RabbitMQ) 활용  |
| SR-15 | 회사별 변동성 요소 도입을 통한 향후 확장 계획         |

> 예외 상황 처리: 잔고 부족, 보유 수량 초과 주문 등

---

## 3. 동작 흐름

1. **주가 갱신 (5분 간격)**

   * 주가 변경 로직 실행
   * DB에 저장된 최근 사건을 반영
   * 변동 비율을 랜덤 또는 알고리즘 기반 적용

2. **사건 생성 (15~30분 간격)**

   * 긍정/부정 이벤트 랜덤 생성
   * 영향도·설명과 함께 DB에 저장
   * 다음 주가 변동 시 자동 반영

3. **사용자 거래**

   * REST API 기반 매수/매도 요청 처리
   * 금액·수량·거래 기록이 DB에 저장
   * WebSocket으로 실시간 시세 전송

4. **장 마감 (2시간 간격)**

   * 전체 사용자 보유 종목 자동 매도
   * 수익률 계산 후 랭킹 반영
   * 다음 라운드를 위해 잔고 초기화

5. **섹터 / 테마 적용**

   * `SectorTheme` 엔티티를 통해 장 특성 저장
   * 예:

     * 기술주 강세
     * 경기 침체 영향
   * 특정 섹터/회사만 변동 폭 가중치 적용 가능

6. **추가 변동성 요소**

   * 회사별 고유 변동성 값

     * positive_rate
     * negative_rate
   * 장 종료 시 해당 요소를 반영하여 주가 차등 조정
   * 변동성 높은 종목은 큰 폭 수익·손실 가능
   * 다양한 투자 전략 유도

---

## 4. 스케줄러 주기

| 항목    | 주기     | 설명                   |
| ----- | ------ | -------------------- |
| 주가 갱신 | 5분     | 랜덤 변동 + 사건 영향 반영     |
| 사건 생성 | 15~30분 | 새로운 사건 생성 및 저장       |
| 랭킹 갱신 | 5분     | 사용자 수익률 계산 후 랭킹 반영   |
| 장 마감  | 2시간    | 모든 종목 강제 매도 및 자금 초기화 |



## 5. 디자인
<img width="982" height="442" alt="1" src="https://github.com/user-attachments/assets/013cc043-b9f5-43af-84db-d8339eb06f90" />


---
