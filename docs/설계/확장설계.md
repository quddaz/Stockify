# 시스템 설계 확장 계획

## 1. 분산 환경에 따른 캐시 아키텍처 고도화

###  문제점

현재는 단일 서버 내부 메모리 캐시를 사용하고 있으나 만약 시스템이 수평 확장될 경우 다음과 같은 문제가 발생할 수 있습니다.

* 다중 서버 운영 시 캐시 불일치 발생
* 서버 재시작 시 캐시 유실

### 개선 방향

**Redis 기반 분산 캐시 도입**

* 모든 서버 인스턴스가 동일 Redis 조회
* Look-aside(조회 시 캐시 확인) 및 Write-through(데이터 변경 시 캐시 동기화) 혼합 사용
* 대상 : 주요 조회 빈도가 높은 데이터 (예: 주식 시세, 랭킹 등)

### 기대 효과

* 수평 확장 시 캐시 정합성 유지
* 캐시 적중률 상승 → DB I/O 감소
* 안정적인 성능 유지

---

## 2. 로드 밸런싱 및 서버 분산

###  문제점

현재 모든 HTTP 요청과 WebSocket 연결이 단일 서버에 집중되어 있어 다음과 같은 문제가 발생할 수 있습니다.

* 트래픽 증가 시 처리 지연
* 단일 장애 영향력 확대
* 수평 확장 어려움
* 실시간 데이터 처리 불안정

### 개선 방향

* **메인 서버와 WebSocket 서버 분리 운영**

    * API/워커 서버 (Core): HTTP 요청 처리, RabbitMQ 소비, 스케줄러, DB 로직 수행
    * WebSocket 서버: 실시간 이벤트 처리 및 클라이언트 Push
* **로드 밸런서(L4/L7, Nginx/AWS ELB 등) 도입**

    * 클라이언트 요청을 WebSocket 서버로 분배
* **서버 간 이벤트 동기화**: Redis Pub/Sub 활용

    * 워커 서버 → 작업 완료 시 WebSocket 서버 이벤트 전달
* **Sticky Session 관리**
    
    * WebSocket 연결의 지속성을 위해 세션 기반 라우팅 적용
* **순서 보장을 위한 RabbitMQ 혼합 사용**

    * 매도/매수와 주식 변경 이벤트 순서 보장을 위해 RabbitMQ 사용
    * API/워커 서버는 RabbitMQ 이벤트 처리 후 Redis Pub/Sub와 연동하여 이벤트 전달

```
[워커 서버]
  ├─ RabbitMQ → 매도/매수 이벤트 처리 및 스케줄러 순서 보장
  └─ 처리 이벤트 → Redis Pub/Sub으로 완료 전달

[WebSocket 서버]
  └─ Redis Pub/Sub 구독 → 실시간 이벤트 클라이언트 Push

Client → WebSocket 서버 (실시간)
Client → Main Server (API 요청)
```

###  기대 효과

* HTTP 요청과 WebSocket 트래픽 분리 → 부하 균형 확보
* 수평 확장 용이, 장애 발생 시 자동 트래픽 재분배
* WebSocket 기반 실시간 데이터 처리 안정성 강화

---

## 3. LLM 기반 실시간 게임성 증가

* **목표**: 주가 급등락 시 LLM을 활용한 자동 뉴스/트렌드 생성
* **기대 효과**: 게임 몰입도 및 사용자 참여도 향상

---

## 4. 회귀 모델 도입

* **목표**: 과거 주식 데이터를 기반으로 단순 회귀 예측 제공
* **기대 효과**: 전략적 투자 의사결정 지원, 게임 경험 강화

---
