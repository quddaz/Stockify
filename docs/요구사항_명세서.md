# Stock Simulator

**서버-클라이언트 기반 주식 시뮬레이션 시스템**

Spring Boot + JPA + WebSocket을 기반으로,
주가는 5분마다 갱신되고 사건(Event)은 15~30분마다 DB에서 불러와
시장에 영향을 주는 구조로 설계된 시뮬레이션 프로젝트입니다.

---

## 1. 프로젝트 개요

* **프로젝트명:** Stock Simulator
* **개발 언어:** Kotlin (Java 21)
* **프레임워크:** Spring Boot
* **데이터베이스:** MySQL
* **기술 스택:** Spring Web, Spring Scheduler, JPA, OAuth2.0, WebSocket, Lombok
* **시스템 구성:** REST API + WebSocket


## 2. 요구사항 명세서

### 사용자 요구사항 (User Requirements)

| 번호    | 요구사항                                 |
| ----- | ------------------------------------ |
| UR-01 | 사용자는 로그인 및 회원가입을 통해 개인 계정을 생성할 수 있다. |
| UR-02 | 사용자는 보유 현금을 이용해 주식을 매수하거나 매도할 수 있다.  |
| UR-03 | 사용자는 실시간 주가 변동을 확인할 수 있다.            |
| UR-04 | 사건 및 주가 갱신이 발생하면 주가가 즉시 변동되는 것을 확인할 수 있다.    |
| UR-05 | 사용자는 자신의 자산, 거래 내역, 수익률을 확인할 수 있다.   |
| UR-06 | 전체 유저의 랭킹을 수익률 기준으로 조회할 수 있다.        |

---

### 개발자 요구사항 (System / Developer Requirements)

| 번호    | 요구사항                                                      |
| ----- | --------------------------------------------------------- |
| SR-01 | 서버는 Spring Boot 기반으로 동작하며, REST API와 WebSocket을 지원한다.     |
| SR-02 | `StockService`는 5분마다 주가를 자동 갱신한다.                         |
| SR-03 | `EventScheduler`는 15~30분마다 사건을 생성하여 DB에 저장한다.             |
| SR-04 | `EventService`는 주가 갱신 시 DB에서 모든 사건을 조회하여 영향을 반영한다.        |
| SR-05 | 거래(`Transaction`)는 사용자, 주식, 수량, 가격, 거래유형(BUY/SELL)을 저장한다. |
| SR-06 | `RankingService`는 사용자 수익률을 계산하고 랭킹을 갱신한다.                 |
| SR-07 | WebSocket은 실시간으로 주가 및 사건 정보를 클라이언트에 전송한다.                 |
| SR-08 | DB는 JPA 기반으로 설계하고, 사건-주식 간 연관관계를 설정한다.                    |

---

## 3. 동작 흐름

### 1) 주가 갱신 (5분 주기)

* `StockScheduler`가 5분마다 `StockService.updateAllStocks()` 호출
* `StockService`는 현재 DB에서 `EventRepository.findAll()`로 사건 목록 조회
* 각 사건의 `impactValue`와 `impactType`을 반영해 주가 조정
* 변경된 주가는 DB에 저장 후 WebSocket으로 클라이언트에 전달

### 2) 사건 생성 (15~30분 주기)

* `EventScheduler`가 15~30분마다 `EventService.createRandomEvent()` 실행
* 랜덤한 사건을 생성하여 DB에 저장
* 새 사건이 반영되면 다음 주가 갱신 때 영향을 미침

### 3) 사용자 거래

* 사용자는 REST API를 통해 주식 매수/매도 요청
* 거래 내역은 DB에 기록되고, 잔액 및 보유 주식 수량이 갱신됨

### 4) 랭킹 업데이트

* `RankingService`가 10분마다 사용자 수익률을 계산하고 순위를 저장

---

## 6. 주기 설정 (Scheduler)

| 항목    | 주기     | 설명                     |
| ----- | ------ | ---------------------- |
| 주가 갱신 | 5분     | 전체 주식 가격 랜덤 변동 + 사건 반영 |
| 사건 생성 | 15~30분 | 새로운 시장 이벤트 발생          |
| 랭킹 갱신 | 10분    | 사용자 수익률 재계산            |

> 개발 단계에서는 10~30초 간격으로 조정해 빠른 테스트 가능
> (`application.yml`에서 주기 설정 가능)

---

## 7. 확장 계획

* AI API를 이용한 사건 제목/내용 자동 생성
* Kafka 기반 실시간 데이터 스트리밍
* JWT 기반 인증 및 사용자별 포트폴리오 분석
* 주가 변동 그래프 및 대시보드 시각화

---

## 8. 결론

이 프로젝트는

* 사건(Event)을 **DB에 저장하고, 주가 갱신 시마다 조회 및 반영**하며
* 스케줄러 기반으로 **자연스러운 주식 시장 변동 시뮬레이션**을 구현하는 것이 목표입니다.

---