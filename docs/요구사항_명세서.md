# Stockity

**서버-클라이언트 기반 주식 시뮬레이션 시스템**

Spring Boot + JPA + WebSocket 기반으로,
2시간마다 장이 열리고 사용자는 주식을 사고팔며 경쟁하는 게임입니다.
주가는 5분마다 갱신되고 사건(Event)은 15~30분마다 발생하여 주가에 반영됩니다.

---

## 1. 프로젝트 개요

| 항목     | 내용                                                             |
| ------ | -------------------------------------------------------------- |
| 프로젝트명  | Stock Simulator                                                |
| 개발 언어  | Kotlin (Java 21)                                               |
| 프레임워크  | Spring Boot                                                    |
| 데이터베이스 | MySQL                                                          |
| 기술 스택  | Spring Web, Spring Scheduler, JPA, OAuth2.0, WebSocket, Lombok |
| 시스템 구성 | REST API + WebSocket                                           |

---

## 2. 요구사항 명세서

### 2.1 사용자 요구사항 (User Requirements)

| ID    | 설명                     |
| ----- | ---------------------- |
| UR-01 | 로그인 및 회원가입 가능          |
| UR-02 | 보유 현금을 이용해 주식 매수/매도 가능 |
| UR-03 | 실시간 주가 확인 가능           |
| UR-04 | 사건 발생 시 주가 즉시 반영       |
| UR-05 | 자산, 거래 내역, 수익률 확인 가능   |
| UR-06 | 전체 유저 수익률 기준 랭킹 조회 가능  |

### 2.2 개발자 요구사항 (System / Developer Requirements)

| ID    | 설명                                     |
| ----- | -------------------------------------- |
| SR-01 | Spring Boot 기반 REST API + WebSocket 지원 |
| SR-02 | 5분마다 주가 자동 갱신                          |
| SR-03 | 15~30분마다 사건 랜덤 생성 및 DB 저장              |
| SR-04 | EventService가 주가 갱신 시 사건 반영            |
| SR-05 | 거래 기록(사용자, 주식, 수량, 가격, 거래 유형) 저장       |
| SR-06 | RankingService가 사용자 수익률 계산 및 랭킹 갱신     |
| SR-07 | WebSocket으로 실시간 주가/사건 전송               |
| SR-08 | JPA 기반 DB 설계, 사건-주식 연관관계 설정            |
| SR-09 | 스케줄러 주기 `application.yml`에서 설정 가능      |
| SR-10 | 장 마감 2시간마다 강제 매도 처리                    |
| SR-11 | 장 마감 후 수익률 계산 후 랭킹 반영                  |
| SR-12 | 초기 개발 단계는 주가 랜덤 변동                     |

> ⚠️ 주식 거래 예외: 잔액 부족, 주문 수량 초과 시 처리 로직 필요

---

## 3. 동작 흐름

1. **주가 갱신 (5분 주기)**

    * `StockService.updateStockPrices()` 실행
    * DB에서 사건 조회 후 영향 반영
    * 랜덤 변동 적용

2. **사건 생성 (15~30분 주기)**

    * `EventScheduler.createRandomEvent()` 실행
    * 사건 유형(긍정/부정), 영향도, 설명 랜덤 생성
    * DB에 저장 후 다음 주가 갱신에 반영

3. **사용자 거래**

    * REST API로 매수/매도 요청
    * 거래 내역 DB 저장, 잔액/보유 주식 갱신

4. **랭킹 업데이트 (2시간 주기)**

    * `RankingService.updateRankings()` 실행
    * 사용자 수익률 기반 랭킹 계산

5. **장 마감 (2시간 주기)**

    * 모든 사용자의 보유 주식 강제 매도
    * 거래 마감, 최종 수익률 계산 후 랭킹 반영
    * 다음 장을 위해 초기 자본금으로 리셋

6. **격동 / 테마 적용**

    * `SectorTheme` 엔티티로 장 특성 저장
    * 예: 기술주 강세장, 경기침체장 등
    * 특정 섹터/테마 주식 가격 가중치 적용 가능

7. **추가 변동성 요소**
   * 회사마다 고유 변동성(positive_rate, negative_rate) 적용
   * 장 마감 시 각 회사의 변동성에 따라 주가 조정
   * 예: 변동성 높은 회사는 장 마감 후 결과에 따라 주가가 더 크게 변동
   * 이를 통해 투자 전략 다양화 유도

---

## 4. 스케줄러 주기

| 항목    | 주기     | 설명                  |
| ----- | ------ | ------------------- |
| 주가 갱신 | 5분     | 전체 주식 랜덤 변동 + 사건 반영 |
| 사건 생성 | 15~30분 | 새로운 사건(Event) DB 저장 |
| 랭킹 갱신 | 2시간    | 사용자 수익률 재계산         |

> 개발 단계에서는 10~30초 간격으로 테스트 가능 (`application.yml`에서 주기 조정 가능)

---

## 5. 확장 계획

1. **AI 기반 사건 뉴스 자동 생성**

    * 사건 제목으로 내용 자동 생성
    * 현실감 있는 사건 뉴스 제공, 게임 몰입도 증가

2. **MQ 기반 실시간 데이터 스트리밍**

    * 주가/사건 데이터를 실시간 스트리밍
    * 대규모 사용자 환경에서도 안정적 전송

3. **Redis 캐싱**

    * 자주 조회되는 주가/사용자 데이터 캐싱
    * DB 부하 감소, 응답 속도 향상

4. **주가 변동 그래프 & 대시보드 시각화**

    * 투자 현황 직관적 파악 가능

5. **회귀 분석 모델 도입**

    * 랜덤 변동 대신 과거 사건 데이터 학습
    * 미래 주가 예측 기능 추가

---