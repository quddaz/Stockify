# Stockity

**서버-클라이언트 기반 주식 시뮬레이션 시스템**

Spring Boot + JPA + WebSocket을 기반으로,
2시간마다 장이 열려 주식 투자를 시뮬레이션으로 하며 경쟁하는 게임입니다.
주가는 5분마다 갱신되고 사건(Event)은 15~30분마다 발생하며 이 과정을 통해 사용자 간 경쟁이 이루어집니다.

각 장마다 사용자는 초기 자본금으로 시작하여 주식을 사고팔며 수익률을 극대화하는 것을 목표로 합니다.

---

## 1. 프로젝트 개요

* **프로젝트명:** Stock Simulator
* **개발 언어:** Kotlin (Java 21)
* **프레임워크:** Spring Boot
* **데이터베이스:** MySQL
* **기술 스택:** Spring Web, Spring Scheduler, JPA, OAuth2.0, WebSocket, Lombok
* **시스템 구성:** REST API + WebSocket

---

## 2. 요구사항 명세서

### 사용자 요구사항 (User Requirements)

* [ ] **UR-01** 사용자는 로그인 및 회원가입을 통해 개인 계정을 생성할 수 있다.
* [ ] **UR-02** 사용자는 보유 현금을 이용해 주식을 매수하거나 매도할 수 있다.
* [ ] **UR-03** 사용자는 실시간 주가 변동을 확인할 수 있다.
* [ ] **UR-04** 사건이 발생하면 주가가 즉시 변동되는 것을 확인할 수 있다.
* [ ] **UR-05** 사용자는 자신의 자산, 거래 내역, 수익률을 확인할 수 있다.
* [ ] **UR-06** 전체 유저의 랭킹을 수익률 기준으로 조회할 수 있다.

---

### 개발자 요구사항 (System / Developer Requirements)

* [ ] **SR-01** 서버는 Spring Boot 기반으로 동작하며, REST API와 WebSocket을 지원한다.
* [ ] **SR-02** `StockService`는 5분마다 주가를 자동 갱신한다.
* [ ] **SR-03** `EventScheduler`는 15~30분마다 사건을 생성하여 DB에 저장한다.
* [ ] **SR-04** `EventService`는 주가 갱신 시 DB에서 모든 사건을 조회하여 영향을 반영한다.
* [ ] **SR-05** 거래(`Transaction`)는 사용자, 주식, 수량, 가격, 거래유형(BUY/SELL)을 저장한다.
* [ ] **SR-06** `RankingService`는 사용자 수익률을 계산하고 랭킹을 갱신한다.
* [ ] **SR-07** WebSocket은 실시간으로 주가 및 사건 정보를 클라이언트에 전송한다.
* [ ] **SR-08** DB는 JPA 기반으로 설계하고, 사건-주식 간 연관관계를 설정한다.
* [ ] **SR-09** 스케줄러 주기는 `application.yml`에서 설정 가능하도록 한다.
* [ ] **SR-10** 장 마감 시 모든 거래를 마감하고 최종 수익률을 계산한다.

---

## 3. 동작 흐름

### 1) 주가 갱신 (5분 주기)

* `StockService`가 5분마다 `updateStockPrices()` 실행
* DB에서 모든 사건(Event)을 조회
* 각 사건의 영향도를 주가에 반영하여 랜덤 변동 적용

### 2) 사건 생성 (15~30분 주기)

* `EventScheduler`가 15~30분마다 `createRandomEvent()` 실행
* 사건 유형(긍정/부정), 영향도, 설명을 랜덤 생성하여 DB에 저장
* 생성된 사건은 다음 주가 갱신 시 반영됨

### 3) 사용자 거래

* 사용자는 REST API를 통해 주식 매수/매도 요청
* 거래 내역은 DB에 기록되고, 잔액 및 보유 주식 수량이 갱신됨

### 4) 랭킹 업데이트

* `RankingService`가 2시간마다 `updateRankings()` 실행

### 5) 장 마감 (2시간 주기)

* 매일 2시간마다 `closeMarket()` 실행
* 모든 거래를 마감하고 최종 수익률을 계산하여 랭킹에 반영
* 장 마감 후 초기화 작업 수행
* 초기화 후 새로운 장이 시작됨

---

## 6. 주기 설정 (Scheduler)

| 항목    | 주기     | 설명                     |
| ----- |--------| ---------------------- |
| 주가 갱신 | 5분     | 전체 주식 가격 랜덤 변동 + 사건 반영 |
| 사건 생성 | 15~30분 | 새로운 시장 이벤트 발생          |
| 랭킹 갱신 | 2시간    | 사용자 수익률 재계산            |

> 개발 단계에서는 10~30초 간격으로 조정해 빠른 테스트 가능
> (`application.yml`에서 주기 설정 가능)

---

## 7. 확장 계획

* AI API를 이용한 사건 제목/내용 자동 생성
* MQ 기반 실시간 데이터 스트리밍
* Redis 캐싱을 통한 성능 최적화
* 주가 변동 그래프 및 대시보드 시각화
* 현재는 랜덤 주가 변동이지만, 회귀 모델 도입을 통한 실제 시장 데이터 반영 가능

### AI 기반 사건 뉴스 자동 생성
향후 프로젝트 확장 단계에서는 AI API를 활용하여
* 사건(Event)의 제목을 통해 내용을 자동 생성하는 기능을 추가할 예정입니다.
* 이를 통해 보다 현실감 있는 사건 뉴스를 제공하고,
* 게임의 몰입도를 높일 수 있을 것입니다.

### MQ 기반 실시간 데이터 스트리밍
향후 프로젝트 확장 단계에서는 MQ를 도입하여
* 주가 변동 및 사건 발생 데이터를 실시간으로 스트리밍하는 기능을 추가할 예정입니다.
* 이를 통해 대규모 사용자 환경에서도 안정적인 데이터 전송이 가능해질 것입니다.
* 또한, 시스템의 확장성과 성능을 향상시킬 수 있을 것입니다.

### Redis 캐싱을 통한 성능 최적화
향후 프로젝트 확장 단계에서는 Redis를 활용하여
* 자주 조회되는 주가 및 사용자 데이터를 캐싱하는 기능을 추가할 예정입니다.
* 이를 통해 데이터베이스 부하를 줄이고,
* 시스템의 응답 속도를 향상시킬 수 있을 것입니다.

### 주가 변동 그래프 및 대시보드 시각화
향후 프로젝트 확장 단계에서는
* 주가 변동 그래프 및 대시보드를 시각화하는 기능을 추가할 예정입니다.
* 이를 통해 사용자는 자신의 투자 현황을 직관적으로 파악할 수 있을 것입니다.

### 회귀 분석 모델 도입 계획
향후 프로젝트 확장 단계에서는 단순 랜덤 변동 대신, 회귀 분석 모델을 도입하여
* 과거 사건 데이터와 주가 변동 패턴을 학습하고
* 이를 기반으로 미래 주가를 예측하는 기능을 추가할 예정입니다.
* 이를 통해 보다 현실감 있는 주식 시뮬레이션 환경을 제공할 수 있을 것입니다.
* 첫 시작을 랜덤 데이터로 시작하여, 12개의 장을 기준으로 회귀 분석을 시작
* 독자적인 데이터를 기반으로 실제 시장과는 다른 시뮬레이션 환경 구축

---